=pod

=head1 NAME

SSL_CTX_set_client_session_cache, SSL_set_remote_addr_ex, SSL_get_remote_addr_ex, SSL_get_prev_client_session - use client IP addresses for session caching

=head1 SYNOPSIS

 #include <openssl/ssl.h>

 int SSL_CTX_set_client_session_cache(SSL_CTX ctx);

 int SSL_set_remote_addr_ex(SSL *s, struct sockaddr_storage *addr);
 int SSL_get_remote_addr_ex(const SSL *s, struct sockaddr_storage *addr);

 int SSL_get_prev_client_session(SSL *s, int flags);

=head1 DESCRIPTION

SSL_CTX_set_client_session_cache() enables session caching for clients using
IP addresses, by setting the cache operational mode for B<ctx> to
SSL_SESS_CACHE_CLIENT and replacing the cache compare and hash functions to
evaluate IP addresses rather than session IDs.

SSL_set_remote_addr_ex() sets an IPv4 or IPv6 address and TCP/UDP port
into B<s> using a sockaddr_storage B<addr>.

SSL_get_remote_addr_ex() returns the current IP address and TCP/UDP port
from B<s> into the sockaddr_storage B<addr>.

SSL_get_prev_client_session() is used to search for and assign a client
session to the B<s> based on previously set IP address and port. The
B<flags> may be a bitwise combination of MUST_HAVE_APP_DATA or
MUST_COPY_SESSION.

=head1 NOTES

The OpenSSL library can store/retrieve SSL/TLS sessions for later reuse.
The sessions can be held in memory for each B<ctx>; if more than one
SSL_CTX object is being maintained, the sessions are unique for each SSL_CTX
object.

In order to reuse a session, a client must send the session's id to the
server. It can only send exactly one id.  The server then either
agrees to reuse the session or it starts a full handshake (to create a new
session).

To reuse a session, use the SSL_set_remote_addr_ex() function to specify the
IP address/port combination that the client is attempting to connect to. Set
the address and port before calling SSL_get_prev_client_session(). Call
SSL_get_prev_client_session() before calling L<SSL_connect(3)>.

The B<flags> argument to SSL_get_prev_client_session() is used to control
how a session is found and assigned.

The port value used in SSL_set_remote_addr_ex() should be specified
consistently, either in network or host order. The values are only used for
comparison, not for connection establishment.

=over 4

=item MUST_HAVE_APP_DATA

This flag means that the session will only be assigned if there is app data
(see L<SSL_SESSION_get_app_data(3)>) set for the
SSL_SESSION.

=item MUST_COPY_SESSION

This flag duplicates the session before assigning it to the B<s>.

=back

=head1 RETURN VALUES

SSL_CTX_set_client_session_cache() returns 1 on success, 0 on failure.

SSL_set_remote_addr_ex() returns 0 on success, -1 on failure.

SSL_get_remote_addr_ex() returns 0 on success, -1 on failure. The addr
structure is filled in with the address and port previously set. The
family may be set to AF_INET and the IPv4 address set to 0 if only the
port has been set.

SSL_get_prev_client_session() returns 1 if a previous session was found,
0 if no previous session was found, and -1 on error.

=head1 SEE ALSO

L<ssl(3)>, L<SSL_set_session(3)>
L<SSL_session_reused(3)>
L<SSL_CTX_add_session(3)>
L<SSL_CTX_sess_number(3)>
L<SSL_CTX_sess_set_cache_size(3)>
L<SSL_CTX_sess_set_get_cb(3)>
L<SSL_CTX_set_session_id_context(3)>
L<SSL_CTX_set_timeout(3)>
L<SSL_CTX_flush_sessions(3)>
L<SSL_CTX_set_session_cache_mode(3)>

=head1 COPYRIGHT

Copyright 2000-2016 The OpenSSL Project Authors. All Rights Reserved.

Licensed under the OpenSSL license (the "License").  You may not use
this file except in compliance with the License.  You can obtain a copy
in the file LICENSE in the source distribution or at
L<https://www.openssl.org/source/license.html>.

Copyright (C) 2016 Akamai Technologies. ALL RIGHTS RESERVED.

This code was originally developed by Akamai Technologies and
contributed to the OpenSSL project under the terms of the Corporate
Contributor License Agreement v1.0

=cut
